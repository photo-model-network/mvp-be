<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    #chat-log {
      border: 1px solid #ccc;
      padding: 10px;
      height: 300px;
      overflow-y: scroll;
      margin-bottom: 10px;
    }

    #chat-message-input {
      width: calc(100% - 120px);
      padding: 10px;
      font-size: 16px;
    }

    #chat-message-submit {
      width: 100px;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <h2>WebSocket Chat Test</h2>

  <div id="chat-log"></div>
  <input id="chat-message-input" type="text" placeholder="Type your message here..." />
  <button id="chat-message-submit">Send</button>

  <script>
    // Replace with your WebSocket URL
    const wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const wsUrl = `${wsProtocol}127.0.0.1:8000/chat/Q5iaPkePNeqBmA7gQSe9Ds/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzI0NTc0Mzc5LCJpYXQiOjE3MjQ0ODc5NzksImp0aSI6ImQ4NzAxMzVjZTYwOTQxZjQ5MTU1MmUwOTg3ZmQxNDFmIiwidXNlcl9pZCI6IlY2QlhWa2FxRmNnYkZBTWhoenBRMlcifQ.l6JWrJZIj1SmenMP5mytg3DsRZx0WNVg4OFFQjJ3FeQ`; // Use the correct port if it's different
    const chatSocket = new WebSocket(wsUrl);

    // Add messages to chat log
    chatSocket.onmessage = function (e) {
      const data = JSON.parse(e.data);
      const message = data.message;
      const user = data.user;
      const timestamp = data.timestamp;
      const chatLog = document.getElementById('chat-log');
      chatLog.innerHTML += `<div><strong>${user}:</strong> ${message} <em>(${timestamp})</em></div>`;
      chatLog.scrollTop = chatLog.scrollHeight;
    };

    // Handle socket closure
    chatSocket.onclose = function (e) {
      console.error('Chat socket closed unexpectedly');
    };

    // Send message on button click
    document.getElementById('chat-message-submit').onclick = function (e) {
      const messageInputDom = document.getElementById('chat-message-input');
      const message = messageInputDom.value;
      chatSocket.send(JSON.stringify({
        'source': "thumbnail",
        'message': message,
        'user_id': 1  // Replace with the actual user ID if needed
      }));
      messageInputDom.value = '';
    };

    // Send message on Enter key press
    document.getElementById('chat-message-input').onkeyup = function (e) {
      if (e.keyCode === 13) {  // Enter key
        document.getElementById('chat-message-submit').click();
      }
    };
  </script>

</body>

</html>